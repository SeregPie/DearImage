(function(){var a=window.URL||window.webkitURL,b=function a(b){if(!(this instanceof a))return new a(function(b){if(b instanceof a)return b._ctx;(b instanceof CanvasRenderingContext2D||b instanceof WebGLRenderingContext)&&(b=b.canvas);var c=document.createElement("canvas").getContext("2d");return c.canvas.width=b.naturalWidth||b.width,c.canvas.height=b.naturalHeight||b.height,c.drawImage(b,0,0),c}(b));this._ctx=b};b.load=function(b,c){if(b)switch(typeof b){case"object":if(b instanceof HTMLImageElement)b.complete?c(this(b)):b.addEventListener("load",function(){c(this(b))}.bind(this));else if(b instanceof HTMLInputElement)switch(b.type){case"file":this.load(b.files,c);break;default:this.load(b.value,c)}else if(b instanceof Uint8Array)this.load(new Blob([b]),c);else if(b instanceof ArrayBuffer)this.load(new Uint8Array(b),c);else if(b instanceof File){var d=new FileReader;d.readAsDataURL(b),this.load(d,c)}else if(b instanceof Blob){var e=a.createObjectURL(b),f=new Image;f.src=e,c(this(f)),a.revokeObjectURL(e)}else b instanceof FileReader?b.readyState>1?this.load(b.result,c):b.addEventListener("load",function(){this.load(b.result,c)}.bind(this)):"number"==typeof b.length&&b.length-1 in b&&this.load(b[0],c);break;case"string":var f=new Image;f.setAttribute("crossOrigin","anonymous"),f.src=b,this.load(f,c)}},b.empty=function(a,b){a=parseInt(a),b=parseInt(b),a=isNaN(a)?0:Math.abs(a),b=isNaN(b)?0:Math.abs(b);var c=document.createElement("canvas").getContext("2d");return c.canvas.width=a,c.canvas.height=b,new this(c)},b.fn=b.prototype={constructor:b,getWidth:function(){return this._ctx.canvas.width},getHeight:function(){return this._ctx.canvas.height},resize:function(a,b,c){if(a=parseInt(a),b=parseInt(b),isNaN(a)&&isNaN(b))return this;isNaN(a)||(a=Math.abs(a)),isNaN(b)||(b=Math.abs(b));var d=this._ctx,e=d.canvas.width,f=d.canvas.height;if(isNaN(a)){if(0===f)return this.constructor.empty(0,b);a=Math.round(e*b/f)}else if(isNaN(b)){if(0===e)return this.constructor.empty(a,0);b=Math.round(f*a/e)}if(a===e&&b===f)return this;if(0===e||0===f||0===a||0===b)return this.constructor.empty(a,b);c=parseFloat(c),isNaN(c)&&(c=.5);for(var i,g=0<c&&c<1?1/c:1/0,h=function(a,b,c){var d=a.canvas;return a=document.createElement("canvas").getContext("2d"),a.canvas.width=b,a.canvas.height=c,a.scale(b/d.width,c/d.height),a.drawImage(d,0,0),a},j=function(a,b){if(a<b)a=Math.min(Math.round(a*g),b);else{if(!(a>b))return b;a=Math.max(Math.round(a/g),b)}return i=!1,a},k=64;k-- >0&&(i=!0,e=j(e,a),f=j(f,b),!i);)d=h(d,e,f);return new this.constructor(d)},crop:function(a,b,c,d){a=parseInt(a),b=parseInt(b),c=parseInt(c),d=parseInt(d);var e=this._ctx,f=e.canvas.width,g=e.canvas.height;if(a=isNaN(a)?0:a<0?Math.max(a+f,0):Math.min(a,f),b=isNaN(b)?0:b<0?Math.max(b+g,0):Math.min(b,g),isNaN(c)?c=f-a:c<0?(c=Math.min(-c,a),a-=c):c=Math.min(c,f-a),isNaN(d)?d=g-b:d<0?(d=Math.min(-d,b),b-=d):d=Math.min(d,g-b),c===f&&d===g)return this;if(0===c||0===d)return this.constructor.empty(c,d);var h=e.canvas;return e=document.createElement("canvas").getContext("2d"),e.canvas.width=c,e.canvas.height=d,e.drawImage(h,a,b,c,d,0,0,c,d),new this.constructor(e)},cropAlign:function(a,b,c){a=parseInt(a),b=parseInt(b);var d=this.getWidth(),e=this.getHeight();if(a=isNaN(a)?d:Math.min(Math.abs(a),d),b=isNaN(b)?e:Math.min(Math.abs(b),e),0===a||0===b)return this.constructor.empty(a,b);if(a===d&&b===e)return this;switch(c=(""+c).toLowerCase().split(/[^a-z0-9]+/).sort().filter(function(){var a=null;return function(b){return a!==b&&(a=b)}}()).join(" ")){case"left top":return this.crop(0,0,a,b);case"right top":return this.crop(-a,0,1/0,b);case"bottom left":return this.crop(0,-b,a,1/0);case"bottom right":return this.crop(-a,-b,1/0,1/0);case"center left":return this.crop(0,Math.max((e-b)/2,0),a,b);case"center right":return this.crop(-a,Math.max((e-b)/2,0),1/0,b);case"center top":return this.crop(Math.max((d-a)/2,0),0,a,b);case"bottom center":return this.crop(Math.max((d-a)/2,0),-b,a,1/0)}return this.crop(Math.max((d-a)/2,0),Math.max((e-b)/2,0),a,b)},scale:function(a,b){return a=parseFloat(a),isNaN(a)?this:(a=Math.abs(a),this.resize(this.getWidth()*a,this.getHeight()*a,b))},scaleMin:function(a,b,c){a=parseInt(a),b=parseInt(b);var d=this.getWidth(),e=this.getHeight();if(a=isNaN(a)?d:Math.abs(a),b=isNaN(b)?e:Math.abs(b),a===d&&b===e)return this;if(0===d||0===e||0===a||0===b)return this.constructor.empty(a,b);var f=a/d,g=b/e,h=Math.min(f,g);return this.scale(h,c)},scaleMax:function(a,b,c){a=parseInt(a),b=parseInt(b);var d=this.getWidth(),e=this.getHeight();if(a=isNaN(a)?d:Math.abs(a),b=isNaN(b)?e:Math.abs(b),a===d&&b===e)return this;if(0===d||0===e||0===a||0===b)return this.constructor.empty(a,b);var f=a/d,g=b/e,h=Math.max(f,g);return this.scale(h,c)},scaleCrop:function(a,b,c,d){return this.scaleMax(a,b,d).cropAlign(a,b,c)},flip:function(){var a=this._ctx.canvas,b=a.width,c=a.height;if(0===b||0===c)return this;var d=document.createElement("canvas").getContext("2d");return d.canvas.width=b,d.canvas.height=c,d.translate(0,c),d.scale(1,-1),d.drawImage(a,0,0),new this.constructor(d)},flop:function(){var a=this._ctx.canvas,b=a.width,c=a.height;if(0===b||0===c)return this;var d=document.createElement("canvas").getContext("2d");return d.canvas.width=b,d.canvas.height=c,d.translate(b,0),d.scale(-1,1),d.drawImage(a,0,0),new this.constructor(d)},rotate90:function(){var a=this._ctx.canvas,b=a.width,c=a.height;if(0===b||0===c)return b===c?this:this.constructor.empty(c,b);var d=document.createElement("canvas").getContext("2d");return d.canvas.width=c,d.canvas.height=b,d.translate(c/2,b/2),d.rotate(Math.PI/2),d.drawImage(a,-b/2,-c/2),new this.constructor(d)},rotate180:function(){var a=this._ctx.canvas,b=a.width,c=a.height;if(0===b||0===c)return this;var d=document.createElement("canvas").getContext("2d");return d.canvas.width=b,d.canvas.height=c,d.translate(b,c),d.scale(-1,-1),d.drawImage(a,0,0),new this.constructor(d)},rotate270:function(){var a=this._ctx.canvas,b=a.width,c=a.height;if(0===b||0===c)return b===c?this:this.constructor.empty(c,b);var d=document.createElement("canvas").getContext("2d");return d.canvas.width=c,d.canvas.height=b,d.translate(c/2,b/2),d.rotate(Math.PI/-2),d.drawImage(a,b/-2,c/-2),new this.constructor(d)},toImage:function(){var a=new Image;return a.src=this.toDataURL.apply(this,arguments),a},toImageData:function(){},toCanvas:function(){return this.toContext().canvas},toContext:function(){var a=this._ctx.canvas,b=document.createElement("canvas").getContext("2d");return b.canvas.width=a.width,b.canvas.height=a.height,b.drawImage(a,0,0),b},toDataURL:function(){var a=this._ctx.canvas;return a.toDataURL.apply(a,arguments)}},this.PaperDuck=b}).call(this);