(function(){var a=function a(b){if(!(this instanceof a)){if(b instanceof a)return b;b&&b.canvas instanceof HTMLCanvasElement&&(b=b.canvas);var c=document.createElement("canvas").getContext("2d");return c.canvas.width=b.naturalWidth||b.width||0,c.canvas.height=b.naturalHeight||b.height||0,c.drawImage(b,0,0),new a(c)}this._ctx=b};a.load=function(a){return Promise.resolve().then(function(){if(a)switch(typeof a){case"string":var b=new Image;return b.crossOrigin="anonymous",b.src=a,this.load(b);case"object":if(a instanceof HTMLImageElement)return a.complete?this(a):new Promise(function(b,c){a.addEventListener("load",function(){b(this(a))}.bind(this)),a.addEventListener("error",function(){c(a)})}.bind(this));if(a instanceof HTMLInputElement)return"file"===a.type?this.load(a.files):this.load(a.value);if(a instanceof File){var c=new FileReader;return c.readAsDataURL(a),this.load(c)}if(a instanceof FileReader)return a.readyState>1?this.load(a.result):new Promise(function(b,c){a.addEventListener("load",function(){this.load(a.result).then(b,c)}.bind(this)),a.addEventListener("error",function(){c(a)})}.bind(this));if("number"==typeof a.length&&a.length-1 in a)return this.load(a[0])}return this(a)}.bind(this))},a.blank=function(a,b){a=parseInt(a),b=parseInt(b),a=isNaN(a)?0:Math.abs(a),b=isNaN(b)?0:Math.abs(b);var c=document.createElement("canvas").getContext("2d");return c.canvas.width=a,c.canvas.height=b,new this(c)},a.fn=a.prototype={constructor:a,getWidth:function(){return this._ctx.canvas.width},getHeight:function(){return this._ctx.canvas.height},resize:function(a,b,c){if(a=parseInt(a),b=parseInt(b),isNaN(a)&&isNaN(b))return this;isNaN(a)||(a=Math.abs(a)),isNaN(b)||(b=Math.abs(b));var d=this._ctx,e=d.canvas.width,f=d.canvas.height;if(isNaN(a)){if(0===f)return this.constructor.blank(0,b);a=Math.round(e*b/f)}else if(isNaN(b)){if(0===e)return this.constructor.blank(a,0);b=Math.round(f*a/e)}if(a===e&&b===f)return this;if(0===e||0===f||0===a||0===b)return this.constructor.blank(a,b);c=parseFloat(c),isNaN(c)?c=2:c>1?c/=c-1:c=1/0;for(var h,g=function(a,b,c){var d=a.canvas;return a=document.createElement("canvas").getContext("2d"),a.canvas.width=b,a.canvas.height=c,a.scale(b/d.width,c/d.height),a.drawImage(d,0,0),a},i=function(a,b){if(a<b)a=Math.min(Math.round(a*c),b);else{if(!(a>b))return b;a=Math.max(Math.round(a/c),b)}return h=!1,a},j=64;j-- >0&&(h=!0,e=i(e,a),f=i(f,b),!h);)d=g(d,e,f);return new this.constructor(d)},clip:function(a,b,c,d){},crop:function(a,b,c,d){a=parseInt(a),b=parseInt(b),c=parseInt(c),d=parseInt(d);var e=this._ctx,f=e.canvas.width,g=e.canvas.height;if(a=isNaN(a)?0:a<0?Math.max(a+f,0):Math.min(a,f),b=isNaN(b)?0:b<0?Math.max(b+g,0):Math.min(b,g),isNaN(c)?c=f-a:c<0?(c=Math.min(-c,a),a-=c):c=Math.min(c,f-a),isNaN(d)?d=g-b:d<0?(d=Math.min(-d,b),b-=d):d=Math.min(d,g-b),c===f&&d===g)return this;if(0===c||0===d)return this.constructor.blank(c,d);var h=e.canvas;return e=document.createElement("canvas").getContext("2d"),e.canvas.width=c,e.canvas.height=d,e.drawImage(h,a,b,c,d,0,0,c,d),new this.constructor(e)},clipAlign:function(a,b,c){},cropAlign:function(a,b,c){a=parseInt(a),b=parseInt(b);var d=this.getWidth(),e=this.getHeight();if(a=isNaN(a)?d:Math.min(Math.abs(a),d),b=isNaN(b)?e:Math.min(Math.abs(b),e),0===a||0===b)return this.constructor.blank(a,b);if(a===d&&b===e)return this;switch(c=(""+c).toLowerCase().split(/[^a-z0-9]+/).sort().filter(function(){var a=null;return function(b){return a!==b&&(a=b)}}()).join(" ")){case"left top":return this.crop(0,0,a,b);case"right top":return this.crop(-a,0,1/0,b);case"bottom left":return this.crop(0,-b,a,1/0);case"bottom right":return this.crop(-a,-b,1/0,1/0);case"center left":return this.crop(0,Math.max((e-b)/2,0),a,b);case"center right":return this.crop(-a,Math.max((e-b)/2,0),1/0,b);case"center top":return this.crop(Math.max((d-a)/2,0),0,a,b);case"bottom center":return this.crop(Math.max((d-a)/2,0),-b,a,1/0)}return this.crop(Math.max((d-a)/2,0),Math.max((e-b)/2,0),a,b)},scale:function(a,b){return a=parseFloat(a),isNaN(a)?this:(a=Math.abs(a),this.resize(this.getWidth()*a,this.getHeight()*a,b))},zoom:function(a,b,c,d){},scaleMin:function(a,b,c){a=parseInt(a),b=parseInt(b);var d=this.getWidth(),e=this.getHeight();if(a=isNaN(a)?d:Math.abs(a),b=isNaN(b)?e:Math.abs(b),a===d&&b===e)return this;if(0===d||0===e||0===a||0===b)return this.constructor.blank(a,b);var f=a/d,g=b/e,h=Math.min(f,g);return this.scale(h,c)},scaleMax:function(a,b,c){a=parseInt(a),b=parseInt(b);var d=this.getWidth(),e=this.getHeight();if(a=isNaN(a)?d:Math.abs(a),b=isNaN(b)?e:Math.abs(b),a===d&&b===e)return this;if(0===d||0===e||0===a||0===b)return this.constructor.blank(a,b);var f=a/d,g=b/e,h=Math.max(f,g);return this.scale(h,c)},scaleClip:function(a,b,c,d){return this.scaleMin(a,b,d).clipAlign(a,b,c)},scaleCrop:function(a,b,c,d){return this.scaleMax(a,b,d).cropAlign(a,b,c)},flip:function(){var a=this._ctx.canvas,b=a.width,c=a.height;if(0===b||0===c)return this;var d=document.createElement("canvas").getContext("2d");return d.canvas.width=b,d.canvas.height=c,d.translate(0,c),d.scale(1,-1),d.drawImage(a,0,0),new this.constructor(d)},flop:function(){var a=this._ctx.canvas,b=a.width,c=a.height;if(0===b||0===c)return this;var d=document.createElement("canvas").getContext("2d");return d.canvas.width=b,d.canvas.height=c,d.translate(b,0),d.scale(-1,1),d.drawImage(a,0,0),new this.constructor(d)},rotate90:function(){var a=this._ctx.canvas,b=a.width,c=a.height;if(0===b||0===c)return b===c?this:this.constructor.blank(c,b);var d=document.createElement("canvas").getContext("2d");return d.canvas.width=c,d.canvas.height=b,d.translate(c/2,b/2),d.rotate(Math.PI/2),d.drawImage(a,-b/2,-c/2),new this.constructor(d)},rotate180:function(){var a=this._ctx.canvas,b=a.width,c=a.height;if(0===b||0===c)return this;var d=document.createElement("canvas").getContext("2d");return d.canvas.width=b,d.canvas.height=c,d.translate(b,c),d.scale(-1,-1),d.drawImage(a,0,0),new this.constructor(d)},rotate270:function(){var a=this._ctx.canvas,b=a.width,c=a.height;if(0===b||0===c)return b===c?this:this.constructor.blank(c,b);var d=document.createElement("canvas").getContext("2d");return d.canvas.width=c,d.canvas.height=b,d.translate(c/2,b/2),d.rotate(Math.PI/-2),d.drawImage(a,b/-2,c/-2),new this.constructor(d)},toImage:function(){var a=new Image;return a.src=this.toDataURL.apply(this,arguments),a},toImageData:function(){},toCanvas:function(){return this.toContext().canvas},toContext:function(){var a=this._ctx.canvas,b=document.createElement("canvas").getContext("2d");return b.canvas.width=a.width,b.canvas.height=a.height,b.drawImage(a,0,0),b},toDataURL:function(){var a=this._ctx.canvas;return a.toDataURL.apply(a,arguments)}},this.PaperDuck=a}).call(this);