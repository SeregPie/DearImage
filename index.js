!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).DearImage=e()}(this,(function(){"use strict";class t{constructor(t){this.context=t}get canvas(){return this.context.canvas}get width(){return this.canvas.width}get height(){return this.canvas.height}}function e(t,e){try{let n=document.createElement("canvas");return n.width=t,n.height=e,n}catch{}throw new Error("HTMLCanvasElement is not supported.")}function n(t,e){try{return new OffscreenCanvas(t,e)}catch{}throw new Error("OffscreenCanvas is not supported.")}function r(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];try{return e(...r)}catch{}try{return n(...r)}catch{}let[o,i]=r;try{let{Canvas:t}=require("canvas");return new t(o,i)}catch{}throw new Error("Canvas is not supported.")}function a(){return r(...arguments).getContext("2d")}function o(t){try{let e=new Image;return e.src=t,e}catch{}throw new Error("HTMLImageElement is not supported.")}function i(t){return function(t){try{return t instanceof HTMLCanvasElement}catch{}return!1}(t)||function(t){try{return t instanceof OffscreenCanvas}catch{}return!1}(t)||(()=>{try{let{Canvas:e}=require("canvas");return t instanceof e}catch{}return!1})()}function c(t){return function(t){try{return t instanceof HTMLImageElement}catch{}return!1}(t)||(()=>{try{let{Image:e}=require("canvas");return t instanceof e}catch{}return!1})()}function u(t){return function(t){return(()=>{try{return t instanceof CanvasRenderingContext2D}catch{}return!1})()||(()=>{try{let{CanvasRenderingContext2D:e}=require("canvas");return t instanceof e}catch{}return!1})()}(t)||function(t){try{return t instanceof WebGL2RenderingContext}catch{}return!1}(t)||function(t){try{return t instanceof WebGLRenderingContext}catch{}return!1}(t)||function(t){try{return t instanceof ImageBitmapRenderingContext}catch{}return!1}(t)||function(t){try{return t instanceof OffscreenCanvasRenderingContext2D}catch{}return!1}(t)}t.blank=function(t,e){return new this(a(t,e))},t.isDearImage=function(e){return e instanceof t};let{isDearImage:s}=t;function f(t,e,n){if(e&&n){let r=a(e,n);return r.drawImage(t,0,0),r}throw new Error}function h(t){return f(t,t.width,t.height)}async function l(t){return await t.decode(),f(t,t.naturalWidth,t.naturalHeight)}async function p(t){return l(function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];try{return o(...e)}catch{}let[r]=e;try{let{Image:t}=require("canvas"),e=new t;return e.src=r,e}catch{}throw new Error("Image is not supported.")}(t))}async function y(t){if(function(t){return"string"==typeof t}(t))return p(t);if(function(t){try{return t instanceof URL}catch{}return!1}(t))return p("".concat(t));if(function(t){try{return t instanceof Buffer}catch{}return!1}(t))return async function(t){if(t.length)return p(t);throw new Error}(t);if(function(t){try{return t instanceof Blob}catch{}return!1}(t))return async function(t){if(t.size){let e,n=URL.createObjectURL(t);try{e=await p(n)}finally{URL.revokeObjectURL(n)}return e}throw new Error}(t);if(c(t))return l(t);if(function(t){return(()=>{try{return t instanceof ImageData}catch{}return!1})()||(()=>{try{let{ImageData:e}=require("canvas");return t instanceof e}catch{}return!1})()}(t))return function(t){let{height:e,width:n}=t,r=a(n,e);return r.putImageData(t,0,0),r}(t);if(i(t))return h(t);if(u(t))return h(t.canvas);if(s(t))return t.context;throw new Error("Failed to create an instance of CanvasRenderingContext2D from the given value.")}t.from=async function(t){if(t instanceof this)return t;return new this(await y(t))},t.prototype.flip=function(t,e){if(t||e){let{canvas:n,sizeX:r,sizeY:a}=this,o=this.constructor.blank(r,a),{context:i}=o;return i.save(),i.translate(t?r:0,e?a:0),i.scale(t?-1:1,e?-1:1),i.drawImage(n,0,0),i.restore(),o}return this},t.prototype.flipY=function(){return this.flip(!0,!1)},t.prototype.flipY=function(){return this.flip(!1,!0)},t.prototype.toImageData=function(){let{context:t,height:e,width:n}=this;return t.getImageData(0,0,n,e)},t.prototype.isBlank=function(){return!this.toImageData().data.some((t=>t))},DearImage.prototype.reframe=function(){throw new Error("Not implemented yet")},t.prototype.resize=function(t,e){let{canvas:n,height:r,width:a}=this;if(t!==a||e!==r){let o=this.constructor.blank(t,e),i=t/a,c=e/r,{context:u}=o;u.save(),u.scale(i,c),u.drawImage(n,0,0),u.restore()}return this},t.prototype.rotate=function(t){if(t){let{canvas:e,height:n,width:r}=this,a=Math.abs(Math.cos(t)),o=Math.abs(Math.sin(t)),i=Math.round(r*a+n*o),c=Math.round(r*o+n*a),u=this.constructor.blank(i,c),{context:s}=u;return s.save(),s.translate(i/2,c/2),s.rotate(t),s.drawImage(e,-r/2,-n/2),s.restore(),u}return this},t.prototype.rescale=function(t,e){let{height:n,width:r}=this,a=Math.round(r*t),o=Math.round(n*e);return this.resize(a,o)},t.prototype.resizeX=function(t,e){let{height:n,width:r}=this;if(e){let e=t/r;return this.scale(e)}return this.resize(t,n)},t.prototype.resizeY=function(t,e){let{height:n,width:r}=this;if(e){let e=t/n;return this.scale(e)}return this.resize(r,t)};var g=Math.PI/2;t.prototype.rotateClockwise=function(){return this.rotate(g)};var d=-g;return t.prototype.rotateCounterClockwise=function(){return this.rotate(d)},t.prototype.scaleX=function(t){return this.scale(t,1)},t.prototype.scaleY=function(t){return this.scale(1,t)},t.prototype.toBuffer=function(){return this.canvas.toBuffer(...arguments)},t.prototype.toDataURL=function(){return this.canvas.toDataURL(...arguments)},t.prototype.toHTMLCanvasElement=function(){let{canvas:t,width:n,height:r}=this,a=e(n,r);return a.getContext("2d").drawImage(t,0,0),a},t.prototype.toHTMLImageElement=function(){return o(this.toDataURL(...arguments))},t.prototype.toOffscreenCanvas=function(){let{canvas:t,height:e,width:r}=this,a=n(r,e);return a.getContext("2d").drawImage(t,0,0),a},t}));
