!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t="undefined"!=typeof globalThis?globalThis:t||self).DearImage=n()}(this,(function(){"use strict";class t{static is(t){return t instanceof this}constructor(t){this.context=t}get canvas(){return this.context.canvas}get width(){return this.canvas.width}get height(){return this.canvas.height}get sizeX(){return this.width}get sizeY(){return this.height}}function n(t,n){try{let e=document.createElement("canvas");return e.width=t,e.height=n,e}catch{}throw new Error("HTMLCanvasElement is not supported.")}function e(t,n){try{return new OffscreenCanvas(t,n)}catch{}throw new Error("OffscreenCanvas is not supported.")}function r(...t){return function(...t){try{return n(...t)}catch{}try{return e(...t)}catch{}let[r,a]=t;try{let{Canvas:t}=require("canvas");return new t(r,a)}catch{}throw new Error("Canvas is not supported.")}(...t).getContext("2d")}var a=Number.isFinite;function i(t){return"string"==typeof t}function u(t,n){return null!=t&&(i(t)&&(t=Number(t)),function(t){return a(t)&&t>=0}(t))?Math.round(t):n}function o(t){return u(t,0)}function c(t){try{let n=new Image;return n.src=t,n}catch{}throw new Error("HTMLImageElement is not supported.")}function s(t){return function(t){try{let{HTMLCanvasElement:n}=globalThis;return t instanceof n}catch{}return!1}(t)||function(t){try{let{OffscreenCanvas:n}=globalThis;return t instanceof n}catch{}return!1}(t)||(()=>{try{let{Canvas:n}=require("canvas");return t instanceof n}catch{}return!1})()}function f(t){return function(t){try{let{HTMLImageElement:n}=globalThis;return t instanceof n}catch{}return!1}(t)||(()=>{try{let{Image:n}=require("canvas");return t instanceof n}catch{}return!1})()}function h(t){return function(t){return(()=>{try{let{CanvasRenderingContext2D:n}=globalThis;return t instanceof n}catch{}return!1})()||(()=>{try{let{CanvasRenderingContext2D:n}=require("canvas");return t instanceof n}catch{}return!1})()}(t)||function(t){try{let{WebGL2RenderingContext:n}=globalThis;return t instanceof n}catch{}return!1}(t)||function(t){try{let{WebGLRenderingContext:n}=globalThis;return t instanceof n}catch{}return!1}(t)||function(t){try{let{ImageBitmapRenderingContext:n}=globalThis;return t instanceof n}catch{}return!1}(t)||function(t){try{let{OffscreenCanvasRenderingContext2D:n}=globalThis;return t instanceof n}catch{}return!1}(t)}t.blank=function(t,n){return new this(r(t=o(t),n=o(n)))},t.isDearImage=t.is.bind(t);let{isDearImage:l}=t;function g(t){if(function(t){return(()=>{try{let{ImageData:n}=globalThis;return t instanceof n}catch{}return!1})()||(()=>{try{let{ImageData:n}=require("canvas");return t instanceof n}catch{}return!1})()}(t))return function(t){let{height:n,width:e}=t,a=r(e,n);e&&n&&a.putImageData(t,0,0);return a}(t);if(s(t))return d(t);if(h(t))return d(t.canvas);if(f(t))return m(t);if(l(t))return t.context;throw new Error("Failed to create an instance of CanvasRenderingContext2D from the given value.")}async function y(t){return i(t)?await async function(t){return await v(t)}(t):function(t){try{let{URL:n}=globalThis;return t instanceof n}catch{}return!1}(t)?await async function(t){return await v(`${t}`)}(t):function(t){try{let{Buffer:n}=globalThis;return t instanceof n}catch{}return!1}(t)?await async function(t){if(t.length)return await v(t);return r(0,0)}(t):function(t){try{let{Blob:n}=globalThis;return t instanceof n}catch{}return!1}(t)?await async function(t){if(t.size){let n=URL.createObjectURL(t);try{return await v(n)}finally{URL.revokeObjectURL(n)}}return r(0,0)}(t):f(t)?await p(t):g(t)}function d(t){return w(t,t.width,t.height)}function w(t,n,e){let a=r(n,e);return n&&e&&a.drawImage(t,0,0),a}function m(t){return w(t,t.naturalWidth,t.naturalHeight)}async function p(t){return await t.decode(),m(t)}async function v(t){let n=function(...t){try{return c(...t)}catch{}let[n]=t;try{let{Image:t}=require("canvas"),e=new t;return e.src=n,e}catch{}throw new Error("Image is not supported.")}(t);return await p(n)}return t.from=function(t){if(this.is(t))return t;return new this(g(t))},t.loadFrom=async function(t){if(this.is(t))return t;return new this(await y(t))},t.prototype.toImageData=function(){let{context:t,sizeX:n,sizeY:e}=this;return t.getImageData(0,0,n,e)},t.prototype.isBlank=function(t){let n=Symbol();return function(){let e=this[n];return void 0===e&&(e=t.apply(this,arguments),this[n]=e),e}}((function(){let{sizeX:t,sizeY:n}=this;return!(t&&n&&this.toImageData().data.some((t=>t)))})),t.prototype.toBuffer=function(...t){let{sizeX:n,sizeY:e}=this;if(n&&e){let{canvas:n}=this;return n.toBuffer(...t)}return Buffer.alloc(0)},t.prototype.toDataURL=function(...t){return this.canvas.toDataURL(...t)},t.prototype.toHTMLCanvasElement=function(){let{sizeX:t,sizeY:e}=this,r=n(t,e);if(t&&e){let{canvas:t}=this;r.getContext("2d").drawImage(t,0,0)}return r},t.prototype.toHTMLImageElement=function(...t){return c(this.toDataURL(...t))},t.prototype.toOffscreenCanvas=function(){let{canvas:t,sizeX:n,sizeY:r}=this,a=e(n,r);return n&&r&&a.getContext("2d").drawImage(t,0,0),a},t}));
