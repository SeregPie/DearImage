!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.PaperDuck=n()}(this,function(){"use strict";var t=function(t){this.context=t},n={canvas:{configurable:!0},width:{configurable:!0},height:{configurable:!0}};function r(t){return new Promise(function(n){n(t())})}function e(t){var n=this;return new Promise(function(r,e){t.complete&&r(n.from(t)),t.addEventListener("load",function(){try{r(n.from(t))}catch(n){e(t)}}),t.addEventListener("error",function(){e(t)})})}function i(t){for(var n=[],r=arguments.length-1;r-- >0;)n[r]=arguments[r+1];return function(){for(var r=[],e=arguments.length;e--;)r[e]=arguments[e];return t.call.apply(t,[this].concat(n,r))}}function a(t,n){var r=this.width,e=this.height;if(0===r||0===e)return this;var i=this.constructor.blankContext(r,e);return i.save(),i.translate(t?r:0,n?e:0),i.scale(t?-1:1,n?-1:1),i.drawImage(this.canvas,0,0),i.restore(),new this.constructor(i)}function o(t){var n=this.height,r=this.width;if(0===n||0===r)return n===r?this:this.constructor.blank(n,r);var e=this.constructor.blankContext(n,r);return e.save(),e.translate(n/2,r/2),e.rotate(Math.PI/(t?-2:2)),e.drawImage(this.canvas,r/-2,n/-2),e.restore(),new this.constructor(e)}return n.canvas.get=function(){return this.context.canvas},n.width.get=function(){return this.canvas.width},n.height.get=function(){return this.canvas.height},Object.defineProperties(t.prototype,n),t.blank=function(t,n){return new this(this.blankContext(t,n))},t.blankCanvas=function(t,n){void 0===t&&(t=0),void 0===n&&(n=0);var r=this.createCanvas();return r.width=t,r.height=n,r},t.blankContext=function(t,n){return this.blankCanvas(t,n).getContext("2d")},t.createCanvas=function(){return document.createElement("canvas")},t.from=function(t){return function(t){var n=t.naturalWidth||t.width,r=t.naturalHeight||t.height,e=this.blankContext(n,r);return e.drawImage(t,0,0),new this(e)}.call(this,t)},t.load=function(t){var n=this;return r(function(){return function(t){return"string"==typeof t}(t)?function(t){var n=this;return r(function(){var r=new Image;return r.crossOrigin="anonymous",r.src=t,e.call(n,r)})}.call(n,t):t instanceof HTMLImageElement?e.call(n,t):void 0})},t.prototype.flop=i(a,!0,!1),t.prototype.flip=i(a,!1,!0),t.prototype.rotate180=i(a,!0,!0),t.prototype.resize=function(t,n,r){if(t=Number.parseInt(t),n=Number.parseInt(n),!Number.isFinite(t)&&!Number.isFinite(n))return this;Number.isFinite(t)&&(t=Math.abs(t)),Number.isFinite(n)&&(n=Math.abs(n));var e,i=this.width,a=this.height;if(Number.isFinite(t)){if(!Number.isFinite(n)){if(0===i)return this.constructor.blank(t,0);n=Math.round(a*t/i)}}else{if(0===a)return this.constructor.blank(0,n);t=Math.round(i*n/a)}if(t===i&&n===a)return this;if(0===i||0===a||0===t||0===n)return this.constructor.blank(t,n);r=Number.parseFloat(r),Number.isFinite(r)?r>1?r/=r-1:r=1/0:r=2;for(var o=function(t,n){if(t<n)t=Math.min(Math.round(t*r),n);else{if(!(t>n))return n;t=Math.max(Math.round(t/r),n)}return e=!1,t},s=this.toCanvas(),u=64;u--;){e=!0;var c=o(i,t),h=o(a,n);if(e)break;var f=this.constructor.blankContext(c,h);f.scale(c/i,h/a),f.drawImage(s,0,0),i=c,a=h,s=f.canvas}return this.constructor.from(s)},t.prototype.rotate90=i(o,!1),t.prototype.rotate270=i(o,!0),t});
