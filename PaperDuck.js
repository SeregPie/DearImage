!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.PaperDuck=e()}(this,function(){"use strict";var t=function(t){this.context=t},e={canvas:{configurable:!0},width:{configurable:!0},height:{configurable:!0}};function s(t){return void 0===t}function n(n){for(var r=[],t=arguments.length-1;0<t--;)r[t]=arguments[t+1];return function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return n.call.apply(n,[this].concat(r,t))}}e.canvas.get=function(){return this.context.canvas},e.width.get=function(){return this.canvas.width},e.height.get=function(){return this.canvas.height},Object.defineProperties(t.prototype,e),t.blank=function(t,e){return new this(this.blankContext(t,e))},t.blankCanvas=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0);var n=this.createCanvas();return n.width=t,n.height=e,n},t.blankContext=function(t,e){return this.blankCanvas(t,e).getContext("2d")},t.createCanvas=function(){return document.createElement("canvas")},t.from=function(){return(t=value)&&"object"==typeof t?value.canvas instanceof HTMLCanvasElement?this.fromImageSource(value.canvas):this.fromImageSource(value):this.blank();var t},t.fromImageSource=function(t){var e=t.naturalWidth||t.width,n=t.naturalHeight||t.height,r=this.blankContext(e,n);return r.drawImage(t,0,0),new this(r)},t.load=function(t){var e=this;return Promise.try(function(){return"string"==typeof t?e.loadString(t):t instanceof HTMLImageElement?e.loadImage(t):t instanceof HTMLInputElement?e.loadInput(t):t instanceof File?e.loadFile(t):t instanceof FileReader?e.loadFileReader(t):e.from(t)})},t.loadFile=function(e){var n=this;return Promise.try(function(){var t=new FileReader;return t.readAsDataURL(e),n.loadFileReader(t)})},t.loadFileReader=function(i){var t=this;return Promise.try(function(){return 1<i.readyState?t.load(i.result):new Promise(function(t,e){n=t,r=e,i.addEventListener("load",n),i.addEventListener("error",r)}).then(function(){return t.load(i.result)}).finally(function(){i.removeEventListener("load",n),i.removeEventListener("error",r)});var n,r})},t.loadImage=function(i){var t=this;return Promise.try(function(){return i.complete?t.fromImageSource(i):new Promise(function(t,e){n=t,r=e,i.addEventListener("load",n),i.addEventListener("error",r)}).then(function(){return t.fromImageSource(i)}).finally(function(){i.removeEventListener("load",n),i.removeEventListener("error",r)});var n,r})},t.loadInput=function(t){var e=this;return Promise.try(function(){return"file"===t.type?0<t.files.length?e.loadFile(t.files[0]):e.blank():e.load(t.value)})},t.loadString=function(e){var n=this;return Promise.try(function(){var t=new Image;return t.crossOrigin="anonymous",t.src=e,n.loadImage(t)})},t.prototype.clip=function(t,e,n,r){void 0===t&&(t=0),void 0===e&&(e=0);var i=this.width,a=this.height;if(t<0&&(t+=i),e<0&&(e+=a),s(n)?n=i:n<0&&(t-=n=-n),s(r)?r=a:r<0&&(e-=r=-r),0===t&&0===e&&n===i&&r===a)return this;if(0===n||0===r)return this.constructor.blank(n,r);var o=this.constructor.blankContext(n,r);return o.drawImage(this.canvas,-t,-e),new this.constructor(o)},t.prototype.clipScale=function(t,e,n,r){return this.scaleMin(t,e,r).clipAlign(t,e,n)},t.prototype.scale=function(t,e,n,r){return this.scaleMax(t,e,r).cropAlign(t,e,n)};var r=function(t,e){var n=this.width,r=this.height;if(0===n||0===r)return this;var i=this.constructor.blankContext(n,r);return i.save(),i.translate(t?n:0,e?r:0),i.scale(t?-1:1,e?-1:1),i.drawImage(this.canvas,0,0),i.restore(),new this.constructor(i)};function f(t){return"number"==typeof t}t.prototype.flop=n(r,!0,!1),t.prototype.flip=n(r,!1,!0),t.prototype.rotate180=n(r,!0,!0),t.prototype.resize=function(t,e,n){void 0===n&&(n=2);var r=this.width,i=this.height;if(0===r||0===i||0===t||0===e)return this.constructor.blank(t,e);if(f(t)&&f(e));else if(f(t))e=Math.round(i*t/r);else{if(!f(e))return this;t=Math.round(r*e/i)}if(t===r&&e===i)return this;n<1&&(n=1/n),1<n?n/=n-1:n=1/0;for(var a,o=64,s=function(t,e){if(t<e)t=Math.min(Math.round(t*n),e);else{if(!(e<t))return e;t=Math.max(Math.round(t/n),e)}return a=!1,t},u=this.context;o--;){a=!0;var c=s(r,t),h=s(i,e);if(a)break;var l=this.constructor.blankContext(c,h);l.scale(c/r,h/i),l.drawImage(u.canvas,0,0),r=c,i=h,u=l}return new this.constructor(u)};var i=function(t){var e=this.height,n=this.width;if(0===e||0===n)return e===n?this:this.constructor.blank(e,n);var r=this.constructor.blankContext(e,n);return r.save(),r.translate(e/2,n/2),r.rotate(Math.PI/(t?-2:2)),r.drawImage(this.canvas,n/-2,e/-2),r.restore(),new this.constructor(r)};t.prototype.rotate90=n(i,!1),t.prototype.rotate270=n(i,!0),t.prototype.scale=function(t,e){return this.resize(this.width*t,this.height*t,e)};var a=function(t,e,n,r){var i=this.width,a=this.height;if(e=isNaN(e)?i:Math.abs(e),n=isNaN(n)?a:Math.abs(n),e===i&&n===a)return this;if(0===i||0===a||0===e||0===n)return this.constructor.blank(e,n);var o=t(e/i,n/a);return this.scale(o,r)};return t.prototype.scaleMin=n(a,Math.min),t.prototype.scaleMax=n(a,Math.max),t});
