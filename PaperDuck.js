!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):n.PaperDuck=e()}(this,function(){"use strict";var n=function(n){this.context=n},e={canvas:{configurable:!0},width:{configurable:!0},height:{configurable:!0}};function t(){return document.createElement("canvas")}function r(n,e){void 0===n&&(n=0),void 0===e&&(e=0);var r=t();return r.width=n,r.height=e,r}function i(n,e){return r(n,e).getContext("2d")}function a(e,t){return new n(i(e,t))}function u(e){var t=i(e.naturalWidth||e.width,e.naturalHeight||e.height);return t.drawImage(e,0,0),new n(t)}function o(n){return new Promise(function(e){e(n())})}function c(n){return o(function(){return n.readyState>1?v(n.result):new Promise(function(r,i){e=r,t=i,n.addEventListener("load",e),n.addEventListener("error",t)}).finally(function(){n.removeEventListener("load",e),n.removeEventListener("error",t)}).then(function(){return v(n.result)});var e,t})}function f(n){return o(function(){var e=new FileReader;return e.readAsDataURL(n),c(e)})}function s(n){return o(function(){return n.complete?u(n):new Promise(function(r,i){e=r,t=i,n.addEventListener("load",e),n.addEventListener("error",t)}).finally(function(){n.removeEventListener("load",e),n.removeEventListener("error",t)}).then(function(){return u(n)});var e,t})}function v(n){var e=this;return o(function(){return function(n){return"string"==typeof n}(n)?(t=n,o(function(){var n=new Image;return n.crossOrigin="anonymous",n.src=t,s(n)})):n instanceof HTMLImageElement?s(n):n instanceof HTMLInputElement?(r=n,o(function(){return"file"===r.type?f(r.files[0]):v(r.value)})):n instanceof File?f(n):n instanceof FileReader?c(n):e.from(n);var t,r})}function d(n){return void 0===n}function h(e,t,r){var a=e.width,u=e.height;if(0===a||0===u)return e;var o=i(a,u);return o.save(),o.translate(t?a:0,r?u:0),o.scale(t?-1:1,r?-1:1),o.drawImage(e.canvas,0,0),o.restore(),new n(o)}function l(e,t){var r=e.height,u=e.width;if(0===r||0===u)return r===u?this:a(r,u);var o=i(r,u);return o.save(),o.translate(r/2,u/2),o.rotate(Math.PI/(t?-2:2)),o.drawImage(e.canvas,u/-2,r/-2),o.restore(),new n(o)}e.canvas.get=function(){return this.context.canvas},e.width.get=function(){return this.canvas.width},e.height.get=function(){return this.canvas.height},Object.defineProperties(n.prototype,e);var m,g,b;return Object.assign(n,{blank:a,blankCanvas:r,blankContext:i,createCanvas:t,from:function(n){return u(n)},load:v}),Object.assign(n.prototype,(m={clip:function(e,t,r,u,o){void 0===t&&(t=0),void 0===r&&(r=0);var c=e.width,f=e.height;if(t<0&&(t+=c),r<0&&(r+=f),d(u)?u=c:u<0&&(t-=u=-u),d(o)?o=f:o<0&&(r-=o=-o),0===t&&0===r&&u===c&&o===f)return e;if(0===u||0===o)return a(u,o);var s=i(u,o);return s.drawImage(e.canvas,-t,-r),new n(s)},flip:function(n){return h(n,!1,!0)},flop:function(n){return h(n,!0,!1)},resize:function(e,t,r,i){if(void 0===i&&(i=2),t=Number.parseInt(t),r=Number.parseInt(r),!Number.isFinite(t)&&!Number.isFinite(r))return this;Number.isFinite(t)&&(t=Math.abs(t)),Number.isFinite(r)&&(r=Math.abs(r));var u,o=e.width,c=e.height;if(Number.isFinite(t)){if(!Number.isFinite(r)){if(0===o)return a(t,0);r=Math.round(c*t/o)}}else{if(0===c)return a(0,r);t=Math.round(o*r/c)}if(t===o&&r===c)return e;if(0===o||0===c||0===t||0===r)return a(t,r);i=Number.parseFloat(i),Number.isFinite(i)?i>1?i/=i-1:i=1/0:i=2;for(var f=function(n,e){if(n<e)n=Math.min(Math.round(n*i),e);else{if(!(n>e))return e;n=Math.max(Math.round(n/i),e)}return u=!1,n},s=e.canvas,v=64;v--;){u=!0;var d=f(o,t),h=f(c,r);if(u)break;var l=this.constructor.blankContext(d,h);l.scale(d/o,h/c),l.drawImage(s,0,0),o=d,c=h,s=l.canvas}return new n(s)},rotate180:function(n){return h(n,!0,!0)},rotate270:function(n){return l(n,!0)},rotate90:function(n){return l(n,!1)}},g=function(n){return function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return n.apply(void 0,[this].concat(e))}},b={},Object.entries(m).forEach(function(n){var e=n[0],t=n[1];b[e]=g(t,e)}),b)),n});
